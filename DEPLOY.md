# üöÄ Deploy no PythonAnywhere

Guia passo a passo para fazer deploy do backend PingMe no PythonAnywhere.

## üìã Pr√©-requisitos

1. Conta no PythonAnywhere (free ou paid)
2. Projeto no GitHub ou acesso via Git

## üîß Passo a Passo

### 1. Preparar o Projeto Localmente

Antes de fazer deploy, certifique-se de que tudo est√° funcionando localmente.

### 2. No PythonAnywhere

#### A. Clonar o Reposit√≥rio

1. Acesse o PythonAnywhere e v√° em **Consoles**
2. Crie um novo console **Bash**
3. Execute:
   ```bash
   cd ~
   git clone https://github.com/seu-usuario/pingMe.git
   cd pingMe/backend
   ```

#### B. Instalar Depend√™ncias

```bash
pip3.10 install --user poetry
poetry install
```

**OU** se preferir usar pip diretamente:
```bash
pip3.10 install --user -r requirements.txt
```

#### C. Configurar Vari√°veis de Ambiente

1. Crie o arquivo `.env`:
   ```bash
   nano ~/pingMe/backend/.env
   ```

2. Cole o seguinte conte√∫do (ajuste com seus dados):
   ```env
   SECRET_KEY=sua-chave-secreta-gerada
   DEBUG=False
   ALLOWED_HOSTS=seu-usuario.pythonanywhere.com,www.seu-usuario.pythonanywhere.com
   CORS_ALLOWED_ORIGINS=https://seu-frontend.com,http://localhost:3000

   DB_NAME=seu-usuario$nome-do-banco
   DB_USER=seu-usuario
   DB_PASSWORD=sua-senha-mysql
   DB_HOST=seu-usuario.mysql.pythonanywhere-services.com
   DB_PORT=3306
   ```

3. **Gerar SECRET_KEY:**
   ```bash
   python3.10 -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
   ```
   Copie o resultado e cole no `.env` no lugar de `sua-chave-secreta-gerada`.

4. **Obter informa√ß√µes do MySQL:**
   - Acesse a aba **"Databases"** no PythonAnywhere
   - Se ainda n√£o criou, crie um novo banco MySQL
   - Anote o nome do banco (formato: `seu-usuario$nome-do-banco`)
   - Use seu usu√°rio e senha do PythonAnywhere
   - O host ser√°: `seu-usuario.mysql.pythonanywhere-services.com`

#### D. Executar Migra√ß√µes

```bash
cd ~/pingMe/backend
python3.10 manage.py migrate contenttypes
python3.10 manage.py migrate authentication
python3.10 manage.py migrate
python3.10 manage.py migrate token_blacklist
```

**Importante:** Execute tamb√©m as migra√ß√µes do `token_blacklist`!

#### E. Coletar Arquivos Est√°ticos

```bash
python3.10 manage.py collectstatic --noinput
```

#### F. Criar Superusu√°rio (Opcional)

```bash
python3.10 manage.py createsuperuser
```

### 3. Configurar o Web App

#### A. Acesse a aba "Web"

No painel do PythonAnywhere, clique em **"Web"**.

#### B. Configure o WSGI File

1. Clique no link do arquivo WSGI (`/var/www/seu-usuario_pythonanywhere_com_wsgi.py`)
2. **Apague todo o conte√∫do** e cole:
   ```python
   import os
   import sys

   path = '/home/seu-usuario/pingMe/backend'
   if path not in sys.path:
       sys.path.append(path)

   os.environ['DJANGO_SETTINGS_MODULE'] = 'backend.settings'

   from django.core.wsgi import get_wsgi_application
   application = get_wsgi_application()
   ```
3. **Substitua `seu-usuario`** pelo seu username do PythonAnywhere
4. Salve o arquivo

#### C. Configurar Source Code e Working Directory

Na se√ß√£o **"Code"**:
- **Source code:** `/home/seu-usuario/pingMe/backend`
- **Working directory:** `/home/seu-usuario/pingMe/backend`

#### D. Configurar Virtualenv

1. No console Bash, execute para encontrar o caminho do virtualenv:
   ```bash
   poetry env info --path
   ```
2. Copie o caminho retornado (exemplo: `/home/seu-usuario/.cache/pypoetry/virtualenvs/backend-XXXXX-py3.13`)
3. Cole no campo **"Enter path to a virtualenv"** na se√ß√£o **"Code"**

#### E. Configurar Static Files e Media Files

Na se√ß√£o **"Static files"**:

1. **Static files:**
   - URL: `/static/`
   - Directory: `/home/seu-usuario/pingMe/backend/staticfiles`

2. **Media files:**
   - URL: `/media/`
   - Directory: `/home/seu-usuario/pingMe/backend/media`

#### F. Reload Web App

Clique no bot√£o verde **"Reload"** no canto superior direito da p√°gina.

### 4. Testar

Acesse:
- API: `https://seu-usuario.pythonanywhere.com/api/`
- Admin: `https://seu-usuario.pythonanywhere.com/admin/`

## üîÑ Atualiza√ß√µes Futuras

Quando fizer altera√ß√µes no c√≥digo:

```bash
cd ~/pingMe/backend
git pull
poetry install
python3.10 manage.py migrate
python3.10 manage.py collectstatic --noinput
```

Depois, clique em **"Reload"** na aba **"Web"**.

## üêõ Solu√ß√£o de Problemas

### Erro 500

1. Verifique os logs em **"Web"** > **"Error log"**
2. Confirme que todas as migra√ß√µes foram executadas
3. Verifique se o `.env` est√° correto e no local correto (`~/pingMe/backend/.env`)

### Static files n√£o carregam

1. Execute `collectstatic` novamente:
   ```bash
   cd ~/pingMe/backend
   python3.10 manage.py collectstatic --noinput
   ```
2. Verifique se configurou corretamente na aba **"Web"** > **"Static files"**
3. Certifique-se de que o caminho est√° correto: `/home/seu-usuario/pingMe/backend/staticfiles`

### Database errors

1. Verifique se as credenciais do banco est√£o corretas no `.env`
2. Confirme que o banco foi criado no PythonAnywhere (aba **"Databases"**)
3. Teste a conex√£o:
   ```bash
   python3.10 manage.py check --database default
   ```

### Import errors

1. Verifique se todas as depend√™ncias foram instaladas:
   ```bash
   poetry install
   ```
2. Use `python3.10` especificamente (n√£o apenas `python3`)
3. Verifique se o virtualenv est√° configurado corretamente

### Erro de migra√ß√µes

Se houver problemas com migra√ß√µes:

```bash
cd ~/pingMe/backend
python3.10 manage.py migrate contenttypes
python3.10 manage.py migrate authentication
python3.10 manage.py migrate --fake-initial
python3.10 manage.py migrate
```

## üìù Notas Importantes

- PythonAnywhere usa Python 3.10 por padr√£o
- Sempre use `python3.10` nos comandos (n√£o apenas `python3`)
- O caminho do projeto deve ser exato: `~/pingMe/backend/`
- O arquivo `.env` deve estar em: `~/pingMe/backend/.env`
- Media files: crie a pasta manualmente se necess√°rio:
  ```bash
  mkdir -p ~/pingMe/backend/media/avatars
  ```

## ‚ö†Ô∏è Limita√ß√µes do Plano Free

- Apenas 1 web app
- MySQL dispon√≠vel (n√£o PostgreSQL)
- Dom√≠nio: `seu-usuario.pythonanywhere.com`
- App dorme ap√≥s 90 dias de inatividade (precisa acessar para "acordar")

## üîí Seguran√ßa

**NUNCA** commite o arquivo `.env` no Git!

Certifique-se de que o `.gitignore` inclui:
```
.env
*.pyc
__pycache__/
db.sqlite3
media/
staticfiles/
logs/
```

